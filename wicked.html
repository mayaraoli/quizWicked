<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wicked Quiz: A História de Glinda</title>
    <!-- Carregamento do Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuração do Tailwind para cor e fonte -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'wicked-green': '#228B22',
                        'glinda-pink': '#FFC0CB',
                        'oz-yellow': '#FFD700',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Estilização para o fundo e a fonte - AGORA TUDO NA TELA CHEIA */
        body {
            background-color: #f0f9ff; /* Azul claro do céu de Oz */
            min-height: 100vh;
            width: 100vw;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 0; /* Removendo padding do body */
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; /* Evita barra de rolagem horizontal */
        }
        
        /* Estilo para a área de conteúdo que ocupa a maior parte da tela */
        #game-content {
            width: 100%;
            max-width: 1200px; /* Mantém um limite razoável para o conteúdo */
            flex-grow: 1;
            min-height: 95vh; /* Ocupa a maior parte da altura visível */
            padding: 1rem; /* Adiciona padding interno em vez do container */
        }

        /* Estilo para botões temáticos */
        .btn-theme {
            transition: all 0.2s ease-in-out;
            @apply font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105;
        }
        .btn-primary {
            @apply btn-theme bg-wicked-green text-white hover:bg-green-700;
        }
        .btn-correct {
            @apply btn-theme bg-glinda-pink text-white hover:bg-pink-500;
        }
        .btn-incorrect {
            @apply btn-theme bg-gray-400 text-white hover:bg-gray-500;
        }
        /* Estilo para o retrato da Glinda */
        .glinda-portrait {
            font-size: 5rem;
            line-height: 1;
        }

        /* Estilo para o Visual Novel (caixa de diálogo) */
        .vn-dialog-box {
            background-color: rgba(0, 0, 0, 0.85); /* Fundo semi-transparente escuro */
            color: white;
            border-top: 5px solid #FFC0CB;
            min-height: 150px;
            padding: 1.5rem;
            border-radius: 0.5rem;
        }

        /* Estilo para o fundo da Cidade Esmeralda usando a imagem carregada */
        .emerald-bg {
            background-image: url('uploaded:cidadeEsmeralda.jpg-ca4ec5da-3a14-4286-9de5-ccdb7816c6e0');
            background-size: cover; /* Revertido para 'cover' para preencher totalmente */
            background-repeat: no-repeat;
            background-position: center;
            /* Cor de fundo de Oz caso a imagem falhe ao carregar */
            background-color: #228B22; 
        }
    </style>
</head>
<body>

    <!-- Título do Jogo - Adicionado ID para ser ocultado/exibido -->
    <h1 id="main-title" class="text-4xl md:text-5xl font-extrabold text-center text-wicked-green mt-6 mb-6 border-b-4 border-glinda-pink pb-2 w-full max-w-4xl">
        Quiz de Oz: A Jornada Começa
    </h1>

    <!-- Área de Conteúdo (Dinâmica) - Agora ocupa a maior parte da tela -->
    <div id="game-content">
        <!-- O conteúdo será injetado aqui pelo JavaScript -->
    </div>

    <!-- Mensagens de Alerta (Substitui alert()) -->
    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 items-center justify-center">
        <div id="message-text" class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center text-xl font-semibold border-4 border-oz-yellow">
            <!-- Texto da mensagem vai aqui -->
            <button onclick="hideMessage()" class="btn-primary mt-4">Entendi</button>
        </div>
    </div>


<script>
    // --- VARIÁVEIS GLOBAIS DE ESTADO ---
    const GAME_STATE = {
        teams: [],
        scores: {},
        phase: 'setup',
        currentQuestionIndex: 0,
        currentTeamIndex: 0,
        questionsUsed: new Set(),
        questionsUsedIds: new Set(),
        // AGORA USANDO A REFERÊNCIA DA IMAGEM CARREGADA
        EMERALD_CITY_BG_URL: 'uploaded:cidadeEsmeralda.jpg-ca4ec5da-3a14-4286-9de5-ccdb7816c6e0', 
        quizQuestions: [
            { id: 1, q: "Qual o nome da universidade mágica onde Elphaba e Glinda se encontram pela primeira vez?" },
            { id: 2, q: "Qual item Glinda sempre usa, que é uma grande parte de sua identidade e magia?" },
            { id: 3, q: "Qual o nome do inventor da cadeira de rodas de Nessa Rose?" },
            { id: 4, q: "Qual o título que Elphaba recebe quando é chamada para a Cidade Esmeralda?" },
            { id: 5, q: "O que o Feiticeiro de Oz quer que Elphaba use para 'ajudar' os animais?" },
            { id: 6, q: "Qual a cor dos sapatos que a irmã de Elphaba, Nessa Rose, recebe?" },
            { id: 7, q: "Quem canta a música 'Popular'?" },
            { id: 8, q: "Qual o apelido que Elphaba e Glinda dão ao seu professor de História?" },
            { id: 9, q: "O que Glinda dá a Elphaba para fazê-la 'popular' no início?" },
            { id: 10, q: "Qual criatura alada Glinda e Elphaba tentam libertar na Cidade Esmeralda?" },
            { id: 11, q: "Qual o nome completo de Glinda (antes dela se tornar 'boa')?" },
            { id: 12, q: "Em que lugar no palco (ou livro) Elphaba se transforma na Bruxa Má do Oeste?" }
        ],
        storyText: [
            "Saudações, Queridos! Eu sou Glinda, a Bruxa Boa, e estou aqui para guiá-los através de uma história de amizade, magia e, claro, um pouco de competição! Sentem-se, acomodem-se e preparem-se para a aventura.",
            "Nossa jornada começa muito antes da estrada de tijolos amarelos. Ela começa no coração de Oz, na prestigiada Universidade Shiz, um lugar de aprendizado e transformação. Eu, Glinda, cheguei lá com a cabeça cheia de sonhos... e uma bagagem cheia de sapatos fabulosos!",
            "E foi lá que o destino me colocou no mesmo quarto que... bem, com Elphaba. Uma garota, como todos sabem, com a pele de uma cor que se destaca. Ah, e sim, ela era uma talentosa — mas um pouco impetuosa — feiticeira.",
            "É claro que começamos como almas completamente opostas. Ela, intensa e reservada; eu, popular e, modéstia à parte, brilhante! Mas o que o destino uniu, nenhuma rivalidade poderia separar. Descobrimos que a amizade verdadeira pode superar qualquer diferença de cor ou temperamento.",
            "Juntas, fomos à Cidade Esmeralda, enfrentamos a verdade sobre o Feiticeiro e aprendemos que nem tudo que é 'mau' é realmente maligno, e nem tudo que é 'bom' é totalmente puro.",
            "Essa é a essência de Oz: o que pensamos saber pode estar completamente errado! E é essa verdade que guiará a próxima fase do nosso encontro. Os portões de Shiz estão se fechando, e agora, meus amigos, é hora de testar o seu conhecimento sobre a verdadeira história de Oz! O quiz de trivia aguarda!"
        ]
    };

    // --- UTILS ---

    /** Exibe uma mensagem modal na tela, substituindo alert() */
    function showMessage(text) {
        document.getElementById('message-text').innerHTML = `
            <p>${text}</p>
            <button onclick="hideMessage()" class="btn-primary mt-4">Entendi</button>
        `;
        document.getElementById('message-box').classList.remove('hidden');
        document.getElementById('message-box').classList.add('flex');
    }

    /** Esconde a mensagem modal */
    function hideMessage() {
        document.getElementById('message-box').classList.remove('flex');
        document.getElementById('message-box').classList.add('hidden');
    }
    
    /** Gerencia a visibilidade do título principal da tela */
    function updateScreenLayout() {
        const titleElement = document.getElementById('main-title');

        // Oculta o título na fase da história para o visual novel limpo
        if (GAME_STATE.phase === 'story') {
            titleElement.classList.add('hidden');
        } else {
            titleElement.classList.remove('hidden');
        }
    }


    // --- FUNÇÕES DE RENDERIZAÇÃO DE FASE ---

    function renderSetupPhase() {
        GAME_STATE.phase = 'setup';
        updateScreenLayout();
        const content = document.getElementById('game-content');
        
        // Remove classes de fundo VN e restaura o layout normal
        content.classList.remove('emerald-bg', 'h-screen', 'w-screen', 'fixed', 'top-0', 'left-0', 'p-0', 'm-0');
        document.body.style.overflow = 'auto'; 
        content.style.minHeight = 'auto';

        content.innerHTML = `
            <!-- Novo wrapper para centralizar o conteúdo e dar um fundo limpo -->
            <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-2xl shadow-xl">
                <h2 class="text-3xl font-semibold mb-6 text-center text-oz-yellow bg-wicked-green p-3 rounded-xl shadow-inner">
                    Fase 1: Configuração dos Grupos
                </h2>
                <p class="text-center mb-6 text-lg text-gray-700">
                    Insira os nomes dos 6 grupos que participarão do Quiz de Oz.
                </p>
                <form id="team-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-md mx-auto">
                    ${Array(6).fill().map((_, i) => `
                        <div class="relative">
                            <label for="team-${i}" class="text-sm font-medium text-gray-700">Grupo ${i + 1}</label>
                            <input type="text" id="team-${i}" class="team-input mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:border-glinda-pink focus:ring-glinda-pink" placeholder="Ex: Macacos Alados" required maxlength="25">
                        </div>
                    `).join('')}
                    <div class="md:col-span-2 text-center mt-6">
                        <button type="submit" class="btn-primary w-full md:w-auto">
                            Começar a História de Glinda
                        </button>
                    </div>
                </form>
            </div>
        `;

        document.getElementById('team-form').addEventListener('submit', handleTeamSetup);
    }

    function handleTeamSetup(event) {
        event.preventDefault();
        const inputs = document.querySelectorAll('.team-input');
        const teamNames = [];

        inputs.forEach(input => {
            const name = input.value.trim();
            if (name) {
                teamNames.push(name);
                GAME_STATE.scores[name] = 0;
            }
        });

        if (teamNames.length !== 6) {
            showMessage("Por favor, insira nomes para todos os 6 grupos antes de começar!");
            return;
        }

        GAME_STATE.teams = teamNames;
        GAME_STATE.currentStoryIndex = 0;
        renderStoryPhase();
    }

    function renderStoryPhase() {
        GAME_STATE.phase = 'story';
        updateScreenLayout();
        const content = document.getElementById('game-content');
        const storyIndex = GAME_STATE.currentStoryIndex;
        const currentText = GAME_STATE.storyText[storyIndex];
        const isLast = storyIndex === GAME_STATE.storyText.length - 1;

        // Adiciona classes para o Visual Novel (fundo e altura total)
        content.classList.add('emerald-bg', 'h-screen', 'w-screen', 'fixed', 'top-0', 'left-0', 'p-0', 'm-0');
        content.style.minHeight = '100vh'; // Garante que ocupe a altura total
        document.body.style.overflow = 'hidden';

        content.innerHTML = `
            <!-- Contêiner do Visual Novel (Layout flex para empurrar diálogo para baixo) -->
            <div class="w-full h-full flex flex-col justify-end p-4 md:p-8">
                
                <!-- Personagem (Glinda) - Posicionado lateralmente e em cima do dialog box -->
                <div class="flex justify-start ml-2 mb-[-20px] z-10">
                    <div class="glinda-portrait text-glinda-pink flex-shrink-0 text-shadow-lg">
                        ✨
                    </div>
                </div>

                <!-- Caixa de Diálogo (Estilo Amor Doce) -->
                <div class="vn-dialog-box w-full max-w-full z-20">
                    <h3 class="text-xl font-bold text-glinda-pink mb-2">Glinda, a Bruxa Boa:</h3>
                    <p class="text-lg leading-relaxed italic mb-4">
                        "${currentText}"
                    </p>

                    <!-- Controles de Navegação -->
                    <div class="text-right">
                        <button onclick="${isLast ? 'startQuiz()' : 'nextStory()'} " class="btn-theme bg-glinda-pink text-white hover:bg-pink-500 py-2 px-4 text-sm">
                            ${isLast ? 'Iniciar o Quiz de Oz! >>' : 'Continuar >>'}
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    function nextStory() {
        if (GAME_STATE.currentStoryIndex < GAME_STATE.storyText.length - 1) {
            GAME_STATE.currentStoryIndex++;
            renderStoryPhase();
        }
    }

    function startQuiz() {
        GAME_STATE.phase = 'quiz';
        GAME_STATE.currentTeamIndex = 0;
        GAME_STATE.currentQuestionIndex = 0;
        GAME_STATE.questionsUsedIds.clear(); // Limpar IDs das perguntas usadas caso haja restart
        
        // Remove o fundo VN e restaura o fluxo normal
        document.getElementById('game-content').classList.remove('emerald-bg', 'h-screen', 'w-screen', 'fixed', 'top-0', 'left-0', 'p-0', 'm-0');
        document.body.style.overflow = 'auto'; // Restaura o scroll
        document.getElementById('game-content').style.minHeight = 'auto';

        renderQuizPhase();
    }

    // Função que renderiza o Placar lateral (ou superior em mobile)
    function renderScoreboard() {
        const sortedTeams = Object.entries(GAME_STATE.scores).sort(([, scoreA], [, scoreB]) => scoreB - scoreA);

        return `
            <div class="w-full md:w-64 md:sticky md:top-0 bg-white p-4 rounded-xl shadow-2xl border-2 border-oz-yellow/50 flex-shrink-0">
                <h3 class="text-xl font-bold text-center mb-3 text-wicked-green border-b pb-2">Placar Atual</h3>
                <ul class="space-y-2">
                    ${sortedTeams.map(([team, score]) => `
                        <li class="flex justify-between items-center text-lg">
                            <span class="font-medium ${score === sortedTeams[0][1] && score > 0 ? 'text-glinda-pink font-extrabold' : 'text-gray-700'}">${team}</span>
                            <span class="text-2xl font-mono text-wicked-green">${score}</span>
                        </li>
                    `).join('')}
                </ul>
            </div>
        `;
    }

    function renderQuizPhase() {
        GAME_STATE.phase = 'quiz';
        updateScreenLayout();
        
        // Se todas as perguntas foram usadas (um ciclo completo), encerra
        if (GAME_STATE.questionsUsedIds.size >= GAME_STATE.quizQuestions.length) {
            return renderResultsPhase();
        }

        const teamName = GAME_STATE.teams[GAME_STATE.currentTeamIndex];
        const questionData = getNextRandomQuestion();
        
        if (!questionData) return renderResultsPhase(); 

        const question = questionData.q;
        const content = document.getElementById('game-content');

        content.innerHTML = `
            <div class="max-w-4xl mx-auto p-4">
                <div class="flex flex-col md:flex-row gap-6">
                    <!-- Placar -->
                    ${renderScoreboard()}

                    <!-- Área da Pergunta -->
                    <div class="flex-grow bg-white p-6 rounded-xl shadow-2xl border-4 border-wicked-green">
                        <h2 class="text-2xl font-bold mb-4 text-glinda-pink">Rodada ${GAME_STATE.questionsUsedIds.size} de ${GAME_STATE.quizQuestions.length}</h2>
                        
                        <div class="text-center p-4 bg-oz-yellow/20 rounded-lg mb-6 border-2 border-oz-yellow">
                            <p class="text-xl font-semibold text-gray-800">
                                Pergunta Sorteada para: 
                                <span class="text-wicked-green font-extrabold text-2xl">${teamName}</span>
                            </p>
                        </div>

                        <!-- Pergunta -->
                        <p class="text-2xl font-light text-gray-900 leading-relaxed mb-8">
                            <span class="font-bold text-wicked-green">P:</span> ${question}
                        </p>

                        <!-- Botões de Ação -->
                        <div class="flex justify-center space-x-4 mt-6">
                            <button onclick="recordAnswer(true)" class="btn-correct flex-1">
                                ✅ Resposta Correta (+1 Ponto)
                            </button>
                            <button onclick="recordAnswer(false)" class="btn-incorrect flex-1">
                                ❌ Resposta Incorreta (0 Pontos)
                            </button>
                        </div>

                        <!-- Aviso -->
                        <p class="text-center text-sm text-gray-500 mt-6 italic">
                            (Como mediador, clique no botão apropriado após a resposta do time.)
                        </p>
                    </div>
                </div>
            </div>
        `;
    }

    function getNextRandomQuestion() {
        // Filtra apenas as perguntas cujos IDs ainda não estão no conjunto questionsUsedIds
        const availableQuestions = GAME_STATE.quizQuestions.filter(q => !GAME_STATE.questionsUsedIds.has(q.id));

        if (availableQuestions.length === 0) {
            return null; // Não há mais perguntas disponíveis
        }

        const randomIndex = Math.floor(Math.random() * availableQuestions.length);
        const questionData = availableQuestions[randomIndex];
        
        // Marcar a pergunta como usada
        GAME_STATE.questionsUsedIds.add(questionData.id);
        
        return questionData;
    }

    function recordAnswer(isCorrect) {
        const teamName = GAME_STATE.teams[GAME_STATE.currentTeamIndex];
        let message = '';

        if (isCorrect) {
            GAME_STATE.scores[teamName] += 1;
            message = `🎉 Ponto para o time ${teamName}! Parabéns, essa foi uma resposta fabulosa!`;
        } else {
            message = `😞 O time ${teamName} errou. Não se preocupe, há mais rodadas em Oz!`;
        }

        showMessage(message);

        // Avança para o próximo time (ciclo por todos os 6 times)
        GAME_STATE.currentTeamIndex = (GAME_STATE.currentTeamIndex + 1) % GAME_STATE.teams.length;
        
        // Um pequeno atraso para a animação da caixa de mensagem sumir antes de renderizar a próxima rodada
        setTimeout(() => {
            // Continua a rodada de quiz se ainda houver perguntas não usadas
            if (GAME_STATE.questionsUsedIds.size < GAME_STATE.quizQuestions.length) {
                renderQuizPhase();
            } else {
                renderResultsPhase();
            }
        }, 500); // 0.5 segundo
    }

    function renderResultsPhase() {
        GAME_STATE.phase = 'results';
        updateScreenLayout();
        const content = document.getElementById('game-content');
        
        const finalScores = Object.entries(GAME_STATE.scores).sort(([, scoreA], [, scoreB]) => scoreB - scoreA);
        const winnerScore = finalScores[0][1];
        const isTie = finalScores.length > 1 && finalScores[0][1] === finalScores[1][1];
        
        const winnerMessage = isTie 
            ? `Um empate esmeralda! Vários times compartilham a vitória com ${winnerScore} pontos!`
            : `O grande vencedor é o time ${finalScores[0][0]} com ${winnerScore} pontos! Fantástico!`;

        // Novo wrapper para centralizar o conteúdo final
        content.innerHTML = `
            <div class="max-w-4xl mx-auto p-4">
                <div class="text-center p-8 bg-glinda-pink/20 rounded-2xl shadow-2xl border-4 border-glinda-pink">
                    <h2 class="text-5xl font-extrabold text-wicked-green mb-4">
                        ${isTie ? '⭐ Empate Mágico! ⭐' : '👑 Vencedor de Oz! 👑'}
                    </h2>
                    <p class="text-2xl mb-8 text-gray-800">${winnerMessage}</p>
                    
                    <!-- Placar Final Detalhado -->
                    <div class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-inner border-2 border-oz-yellow">
                        <h3 class="text-xl font-bold mb-4 text-wicked-green">Placar Final</h3>
                        <ul class="space-y-3">
                            ${finalScores.map(([team, score], index) => `
                                <li class="flex justify-between items-center p-2 rounded-lg ${index === 0 && !isTie ? 'bg-oz-yellow/30 font-bold' : 'bg-gray-50'}">
                                    <span class="text-xl text-gray-800">${index + 1}. ${team}</span>
                                    <span class="text-3xl font-mono text-wicked-green">${score}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <!-- Botão de Recomeçar -->
                    <button onclick="window.location.reload()" class="btn-primary mt-8">
                        Jogar Novamente e Descobrir Novas Verdades em Oz
                    </button>
                </div>
            </div>
        `;
    }

    // --- INICIALIZAÇÃO ---
    window.onload = function() {
        renderSetupPhase();
    };
</script>

</body>
</html>
