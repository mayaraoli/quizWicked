<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wicked Quiz: A História de Glinda</title>
    
    
<script src="https://cdn.tailwindcss.com"></script>
    
    
<script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // VERDE MAIS VIVO (Vibrant Emerald)
                        'wicked-green': '#00A86B',
                        // ROSA MAIS VIVO (Vibrant Glinda Pink)
                        'glinda-pink': '#FF99CC',
                        'hot-pink': '#FF69B4', // Hot Pink (para respostas corretas)
                        'oz-yellow': '#FFD700', // Ouro de Oz
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* --- ESTILOS GERAIS DE TELA (FULL SCREEN) --- */
        body {
            background-color: #f0f9ff;
            min-height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        #game-content {
            width: 100%;
            flex-grow: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.5s ease-in-out; /* Transição para suavizar mudanças de layout */
        }

        /* --- ANIMAÇÕES DE TRANSIÇÃO --- */
        /* Efeito de saída (zoom out e some) */
        @keyframes fade-out-zoom {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.9); }
        }
        /* Efeito de entrada (começa pequeno e aparece) */
        @keyframes fade-in-scale {
            0% { opacity: 0; transform: scale(0.98); }
            100% { opacity: 1; transform: scale(1); }
        }
        /* Efeito de entrada suave (para o fundo da história e quiz) */
        @keyframes background-fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-fade-out {
            animation: fade-out-zoom 0.5s forwards;
        }

        .animate-fade-in {
            animation: fade-in-scale 0.5s forwards;
        }
        
        /* Fundo para Story e Quiz */
        .emerald-bg-game {
            animation: background-fade-in 1s ease-out forwards;
            background-image: url('https://i.imgur.com/xnrTEQh.jpeg');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #00A86B; /* Fallback */
            width: 100%;
            height: 100%;
            position: fixed; /* Fundo fixo para cobrir toda a tela */
            top: 0;
            left: 0;
            z-index: -1; /* Para ficar atrás do conteúdo */
        }


        /* --- ESTILOS TEMÁTICOS (VN E BOTÕES) --- */
        .btn-theme {
            transition: all 0.2s ease-in-out;
            @apply font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105;
        }
        .btn-primary {
            @apply btn-theme bg-wicked-green text-white hover:bg-green-700;
        }
        .glinda-portrait {
            font-size: 5rem;
            line-height: 1;
        }

        /* Caixa de Diálogo Genérica (para Story e Quiz) */
        .game-dialog-box {
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            border-top: 5px solid #FF99CC;
            min-height: 150px;
            padding: 1.5rem;
            border-radius: 0.5rem;
        }

        /* Quiz Card Styling for VN feel */
        .quiz-card-vn {
            background-color: rgba(0, 0, 0, 0.85); /* Mesma transparência do diálogo */
            border-top: 5px solid #FF99CC; /* Mesma borda rosa */
            padding: 1.5rem;
            border-radius: 0.5rem;
            color: white; /* Texto claro */
        }
        .quiz-card-vn .question-text {
            color: white;
            font-size: 2.25rem; /* text-4xl */
            line-height: 1.2;
        }
        .quiz-card-vn .options-container {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* --- ESTILOS PARA AS ALTERNATIVAS (AJUSTADAS PARA VN) --- */
        .option-button-vn {
            transition: all 0.3s ease;
            @apply w-full py-4 px-4 text-xl md:text-2xl text-left border-2 border-oz-yellow bg-gray-800/70 text-white rounded-xl shadow-md hover:bg-oz-yellow/30 font-medium;
        }
        .option-button-vn.correct {
            @apply bg-hot-pink border-pink-700 text-white shadow-xl scale-105;
        }
        .option-button-vn.incorrect {
            @apply bg-red-600/70 border-red-800 text-white shadow-lg opacity-50;
        }
        .option-button-vn.correct-unselected { /* Para a resposta correta não clicada */
             @apply bg-glinda-pink/50 border-glinda-pink text-white;
        }

        /* --- ESTILOS DO CARD FLIP (ADAPTADO PARA VN) --- */
        /* Mantemos o flip, mas o conteúdo dentro dele é que muda para o estilo VN */
        .perspective-1000 {
            perspective: 1000px;
            height: 100%;
            min-height: 500px;
        }

        .flip-card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 1s;
            transform-style: preserve-3d;
            transform: rotateY(0deg);
            min-height: inherit;
        }

        .flip-card.is-flipped {
            transform: rotateY(180deg);
        }

        .flip-card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            /* REMOVIDO: BG branco e borda amarela forte - agora é estilo VN */
            @apply p-0 rounded-xl shadow-none border-none;
            background-color: transparent; /* A face não terá fundo próprio */
        }

        .flip-card-front {
            transform: rotateY(0deg);
        }

        .flip-card-back {
            transform: rotateY(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            /* Fundo quase branco para o verso */
            @apply bg-white/95 shadow-inner rounded-xl;
            padding: 1.5rem; /* Ajustado padding */
        }
        /* FIM DOS ESTILOS DO CARD FLIP */

        /* Placar no Quiz (ajustado para o fundo VN) */
        .quiz-scoreboard {
            background-color: rgba(255, 255, 255, 0.85); /* Fundo translúcido */
            border: 2px solid #00A86B; /* Borda verde */
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            flex-shrink: 0; /* Impede que ele encolha */
        }

        .quiz-scoreboard h3 {
            color: #FF99CC; /* Título rosa */
        }

        .quiz-scoreboard li span {
            color: #374151; /* Texto escuro para contraste */
        }
        .quiz-scoreboard li .font-extrabold {
            color: #FF69B4; /* Pontuação do vencedor rosa forte */
        }
        .quiz-scoreboard li .text-wicked-green {
            color: #00A86B; /* Pontuação verde */
        }


    </style>
</head>
<body class="bg-blue-50">

    
<h1 id="main-title" class="text-4xl md:text-5xl font-extrabold text-center text-wicked-green mt-6 mb-6 border-b-4 border-glinda-pink pb-2 w-full max-w-4xl">
        Quiz de Oz: A Jornada Começa
    </h1>

    
<audio id="game-audio" loop>
        
        <!-- MUDANÇA: Atualizado o SRC do áudio -->
        <source src="https://s31.aconvert.com/convert/p3r68-cdx67/0c42t-95pao.mp3" type="audio/mpeg">
        Seu navegador não suporta o elemento de áudio.
    </audio>

    
<div id="emerald-background" class="hidden emerald-bg-game"></div>

    
<div id="game-content">
        
</div>

    
<div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 items-center justify-center">
        <div id="message-text" class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center text-xl font-semibold border-4 border-oz-yellow">
            
<button onclick="hideMessage()" class="btn-primary mt-4">Entendi</button>
        </div>
    </div>


<script>
    // --- VARIÁVEIS GLOBAIS DE ESTADO ---
    const GAME_STATE = {
        teams: [],
        scores: {},
        phase: 'setup',
        currentQuestionIndex: 0,
        teamOrder: [],
        teamOrderIndex: 0,
        questionsUsedIds: new Set(), // Usaremos IDs para rastrear perguntas

        quizQuestions: [
           { id: 1, q: "Quem está narrando a história?", options: [
                { text: "A Bruxa Má do Oeste", isCorrect: false },
                { text: "Glinda, a Boa.", isCorrect: true },
                { text: "O Mágico de Oz", isCorrect: false },
                { text: "Um visitante de Oz", isCorrect: false }
            ]},
            { id: 2, q: "Qual é o nome da cidade onde a história acontece?", options: [
                { text: "Cidade Azul", isCorrect: false },
                { text: "Cidade das Esmeraldas.", isCorrect: true },
                { text: "Shiz", isCorrect: false },
                { text: "Oz do Norte", isCorrect: false }
            ]},
            { id: 3, q: "Como Glinda descreve a Cidade das Esmeraldas?", options: [
                { text: "Um lugar escuro e silencioso", isCorrect: false },
                { text: "Uma cidade simples e sem cor", isCorrect: false },
                { text: " Como um lugar muito brilhante e verde", isCorrect: true },
                { text: "Um vilarejo abandonado", isCorrect: false }
            ]},
            { id: 4, q: "Quem era o Mágico de Oz?", options: [
                { text: "O pai de Glinda", isCorrect: false },
                { text: "Um guerreiro que lutava contra bruxas", isCorrect: false },
                { text: "Um verdadeiro mago com poderes divinos", isCorrect: false },
                { text: " Um homem que fingia ter poderes mágicos e governava Oz", isCorrect: true }
            ]},
            { id: 5, q: "O que o Mágico fazia para enganar o povo?", options: [
                { text: "Dava presentes mágicos", isCorrect: false },
                { text: "Usava máquinas e truques para parecer poderoso e mágico.", isCorrect: true },
                { text: "Usava feitiços verdadeiros", isCorrect: false },
                { text: "Prometia destruir Elphaba", isCorrect: false }
            ]},
            { id: 6, q: "Qual era o nome da Bruxa Má do Oeste?", options: [
                { text: "Dorothea", isCorrect: true },
                { text: "Morgana", isCorrect: false },
                { text: "Glinda", isCorrect: false },
                { text: "Elphaba.", isCorrect: false }
            ]},
            { id: 7, q: "Por que Elphaba foi chamada de “Bruxa Má”?", options: [
                { text: "Porque destruiu a cidade", isCorrect: false },
                { text: "Porque lançou um feitiço contra Glinda", isCorrect: false },
                { text: " Porque o Mágico espalhou mentiras dizendo que ela era perigosa.", isCorrect: true },
                { text: "Porque quis se tornar rainha", isCorrect: false }
            ]},
            { id: 8, q: "O que Elphaba tentou fazer quando descobriu as mentiras do Mágico?", options: [
                { text: "Fugiu para outro reino", isCorrect: false },
                { text: "Tentou contar a verdade ao povo", isCorrect: true },
                { text: "Tentou roubar o poder do Mágico", isCorrect: false },
                { text: "Criou um exército de bruxas", isCorrect: false }
            ]},
            { id: 9, q: "Como o povo reagiu às palavras do Mágico sobre Elphaba?", options: [
                { text: "Ficou ao lado dela", isCorrect: false },
                { text: "Acreditou nas mentiras e passou a temê-la", isCorrect: true },
                { text: "Expulsou o Mágico da cidade", isCorrect: false },
                { text: "Ignorou o que ele disse", isCorrect: false }
            ]},
            { id: 10, q: "Qual era a relação entre Glinda e Elphaba?", options: [
                { text: " Elas eram amigas.", isCorrect: true },
                { text: "Eram inimigas", isCorrect: false },
                { text: "Eram irmãs", isCorrect: false },
                { text: "Nunca se conheceram", isCorrect: false }
            ]},
            { id: 11, q: "O que aconteceu com o Mágico no fim da história?", options: [
                { text: "Ele foi preso por Elphaba", isCorrect: false },
                { text: " Ele desapareceu e deixou suas mentiras para trás.", isCorrect: true },
                { text: "Tornou-se rei de Oz", isCorrect: false },
                { text: "Pediu perdão ao povo", isCorrect: false }
            ]},
            { id: 12, q: "O que algumas pessoas dizem ver no céu quando o vento sopra?", options: [
                { text: "Um arco-íris mágico", isCorrect: false },
                { text: "O castelo do Mágico", isCorrect: false },
                { text: "Uma sombra verde, que dizem ser Elphaba observando Oz.", isCorrect: true },
                { text: "O chapéu de Glinda", isCorrect: false }
            ]},
            { id: 13, q: "O que Glinda quer dizer quando fala “nem tudo que reluz é verdadeiro”?", options: [
                { text: "Que nem tudo que parece bom ou bonito realmente é, como o Mágico e suas mentiras.", isCorrect: true },
                { text: "Que o ouro é falso", isCorrect: false },
                { text: "Que a cidade está escura", isCorrect: false },
                { text: "Que a magia acabou em Oz", isCorrect: false }
            ]}

        ],
        storyText: [
             "Olá, visitante! 🌟Seja muito bem-vindo à Cidade das Esmeraldas, o coração reluzente da terra de Oz! Tudo aqui brilha em tons de verde: as ruas, as torres e até o ar parece cintilar. Eu sou Glinda, a Boa, e é um prazer mostrar o lugar mais encantado deste mundo." ,
              "Mas, antes de conhecer os jardins e o Palácio, preciso te contar algo que muitos preferem esconder… A verdade sobre o Mágico de Oz e a chamada Bruxa Má do Oeste." ,
             "Há algum tempo, o Mágico chegou prometendo sabedoria, poder e paz. Todos o adoraram! Ele parecia bondoso e justo, mas… nem tudo era verdade. O Mágico mentia. Usava máquinas e truques para enganar o povo, fazendo-os acreditar que tinha poderes mágicos. Assim, controlava Oz com medo e ilusões." ,
             "Foi então que surgiu Elphaba, uma jovem bruxa de pele verde e coração corajoso. Ela descobriu os segredos do Mágico e quis revelar tudo para proteger o povo. Só que o Mágico, temendo ser descoberto, espalhou boatos terríveis sobre ela — dizendo que era perigosa e cruel." ,
             "O povo acreditou e passou a chamá-la de Bruxa Má do Oeste. Eu… bom, eu era sua amiga. E embora eu também tenha acreditado em algumas mentiras, hoje sei que ela só queria fazer o bem." ,
              "Agora, quando o vento sopra forte e uma sombra verde cruza o céu, alguns dizem que é Elphaba observando Oz de longe. Eu gosto de acreditar nisso. 💚",
             "E quanto ao Mágico? Ele desapareceu, deixando apenas suas promessas vazias e sua grande ilusão para trás." ,
              "Venha comigo, visitante! A Cidade das Esmeraldas ainda brilha — mas, lembre-se: nem tudo que reluz é verdadeiro." 

        ]
    };

    let CURRENT_QUESTION_DATA = null;
    let storyKeyListener = null;
    const emeraldBackgroundElement = document.getElementById('emerald-background');

    // --- UTILS ---

    /** Embaralha um array no local */
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    /** Exibe a caixa de mensagem customizada */
    function showMessage(text) {
        document.getElementById('message-text').innerHTML = `
            <p>${text}</p>
            <button onclick="hideMessage()" class="btn-primary mt-4">Entendi</button>
        `;
        document.getElementById('message-box').classList.remove('hidden');
        document.getElementById('message-box').classList.add('flex');
    }

    /** Oculta a caixa de mensagem customizada */
    function hideMessage() {
        document.getElementById('message-box').classList.remove('flex');
        document.getElementById('message-box').classList.add('hidden');

        // Se estivermos no quiz, tenta avançar
        if (GAME_STATE.phase === 'quiz') {
            if (GAME_STATE.questionsUsedIds.size < GAME_STATE.quizQuestions.length) {
                renderQuizPhase();
            } else {
                renderResultsPhase();
            }
        }
    }

    /** Ajusta o layout da tela (ex: esconde o título na VN) */
    function updateScreenLayout() {
        const titleElement = document.getElementById('main-title');

        if (GAME_STATE.phase === 'story' || GAME_STATE.phase === 'quiz') {
            titleElement.classList.add('hidden');
            emeraldBackgroundElement.classList.remove('hidden'); // Mostra o fundo esmeralda
        } else {
            titleElement.classList.remove('hidden');
            emeraldBackgroundElement.classList.add('hidden'); // Esconde o fundo esmeralda
        }
    }

    // --- LÓGICA DO PLAYER DE ÁUDIO ---
    /** Alterna (play/pause) o áudio do jogo */
    function toggleAudio() {
        const audio = document.getElementById('game-audio');
        const btn = document.getElementById('play-pause-btn');

        if (!audio || !btn) return;

        if (audio.paused) {
            audio.play().catch(e => {
                console.error("Erro ao tocar áudio:", e);
                showMessage("O navegador bloqueou o áudio. Por favor, clique em 'Entendi' e tente tocar a música novamente.");
            });
            btn.innerHTML = '⏸️ Pausar Música';
        } else {
            audio.pause();
            btn.innerHTML = '▶️ Tocar Música';
        }
    }


    // --- FUNÇÕES DE EVENTO DE TECLADO ---

    /** Configura o listener para a tecla 'Enter' durante a história */
    function setupStoryKeyListener() {
        removeStoryKeyListener();
        storyKeyListener = function(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                const isLast = GAME_STATE.currentStoryIndex === GAME_STATE.storyText.length - 1;
                if (isLast) {
                    startQuiz();
                } else {
                    nextStory();
                }
            }
        };
        document.addEventListener('keydown', storyKeyListener);
    }

    /** Remove o listener da tecla 'Enter' */
    function removeStoryKeyListener() {
        if (storyKeyListener) {
            document.removeEventListener('keydown', storyKeyListener);
            storyKeyListener = null;
        }
    }


    // --- FUNÇÕES DE RENDERIZAÇÃO DE FASE ---

    /** Renderiza a tela inicial de configuração dos times */
    function renderSetupPhase() {
        removeStoryKeyListener();

        const audio = document.getElementById('game-audio');
        if (audio && !audio.paused) {
            audio.pause();
        }

        GAME_STATE.phase = 'setup';
        updateScreenLayout();
        const content = document.getElementById('game-content');

        content.classList.remove('fixed', 'inset-0', 'p-0', 'm-0', 'h-screen', 'w-screen', 'top-0', 'left-0', 'story-enter', 'animate-fade-in', 'animate-fade-out');
        content.classList.add('relative', 'flex-col', 'justify-center', 'items-center'); // Garante que o setup fique centralizado

        document.body.style.overflow = 'auto';
        content.style.minHeight = 'auto'; // Reset min-height para setup

        // Esconde o background do jogo para a tela de setup
        emeraldBackgroundElement.classList.add('hidden');


        content.innerHTML = `
            
<div class="w-full max-w-7xl mx-auto bg-glinda-pink/10 p-8 md:p-16 rounded-3xl shadow-2xl border-4 border-wicked-green transform transition duration-300">
                
                <h2 class="text-4xl lg:text-5xl font-extrabold mb-4 text-center text-wicked-green flex items-center justify-center">
                    <span class="text-5xl lg:text-6xl mr-3 text-oz-yellow">👑</span>
                    Fase 1: Convocação dos Times de Oz
                    <span class="text-5xl lg:text-6xl ml-3 text-oz-yellow">👑</span>
                </h2>
                
                <p class="text-center mb-10 text-xl lg:text-2xl text-gray-700 italic border-b-2 border-glinda-pink pb-4 max-w-4xl mx-auto">
                    Reúnam seus 6 grupos! Quem levará a glória da Cidade Esmeralda? Insira os nomes de suas equipes abaixo.
                </p>
                
                
<form id="team-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                    ${Array(6).fill().map((_, i) => `
                        <div class="relative">
                            <label for="team-${i}" class="text-xl font-bold text-glinda-pink block mb-2">
                                Time ${i + 1}
                            </label>
                            <input type="text" id="team-${i}"
                                class="team-input mt-1 block w-full p-4 md:p-5 border-2 border-wicked-green rounded-xl shadow-lg
                                       focus:ring-4 focus:ring-glinda-pink focus:border-glinda-pink transition duration-150 text-xl
                                       placeholder-gray-400"
                                placeholder="Nome do seu time" required maxlength="25">
                        </div>
                    `).join('')}
                    
<div class="md:col-span-2 lg:col-span-3 text-center mt-10">
                        <button type="submit"
                            class="w-full md:w-3/4 lg:w-2/3 font-extrabold py-5 px-8 rounded-full shadow-2xl transition-all duration-300 transform hover:scale-105
                                   bg-gradient-to-r from-glinda-pink to-hot-pink text-white border-4 border-oz-yellow hover:from-hot-pink hover:to-glinda-pink group
                                   focus:outline-none focus:ring-4 focus:ring-wicked-green/50">
                            <span class="flex items-center justify-center text-2xl lg:text-3xl">
                                Começar a História de Glinda
                                <span class="ml-3 text-3xl group-hover:rotate-12 transition-transform duration-300">✨</span>
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        `;

        document.getElementById('team-form').addEventListener('submit', handleTeamSetup);
    }

    /** Processa o formulário de times e inicia a história */
    function handleTeamSetup(event) {
        event.preventDefault();
        const inputs = document.querySelectorAll('.team-input');
        const teamNames = [];

        inputs.forEach(input => {
            const name = input.value.trim();
            if (name) {
                teamNames.push(name);
            }
        });

        if (teamNames.length !== 6) {
            showMessage("Por favor, insira nomes para todos os 6 grupos antes de começar!");
            return;
        }

        GAME_STATE.teams = teamNames;
        GAME_STATE.scores = teamNames.reduce((acc, name) => {
            acc[name] = 0;
            return acc;
        }, {});
        GAME_STATE.teamOrder = [...teamNames];
        shuffleArray(GAME_STATE.teamOrder);
        GAME_STATE.teamOrderIndex = 0;


        // --- TRANSIÇÃO 1: SETUP -> STORY ---
        const content = document.getElementById('game-content');

        // 1. Aplica a animação de fade-out no conteúdo atual
        content.classList.add('animate-fade-out');

        // 2. Espera a animação terminar (500ms) antes de renderizar a próxima fase
        setTimeout(() => {
            GAME_STATE.currentStoryIndex = 0;
            setupStoryKeyListener();

            // Remove o fade-out antes de renderizar o novo conteúdo
            content.classList.remove('animate-fade-out');

            renderStoryPhase();
        }, 500);
    }

    /** Renderiza a fase da história (Visual Novel) */
    function renderStoryPhase() {
        GAME_STATE.phase = 'story';
        updateScreenLayout();
        const content = document.getElementById('game-content');
        const storyIndex = GAME_STATE.currentStoryIndex;
        const currentText = GAME_STATE.storyText[storyIndex];
        const isLast = storyIndex === GAME_STATE.storyText.length - 1;

        // Limpa classes de setup e adiciona as de VN
        content.classList.remove('relative', 'flex-col', 'justify-center', 'items-center');
        content.classList.add('fixed', 'inset-0', 'p-0', 'm-0', 'story-enter');
        content.style.minHeight = '100vh'; // Garante que o game-content ocupe a tela inteira para o VN
        document.body.style.overflow = 'hidden';

        // Mostra o fundo esmeralda para a história
        emeraldBackgroundElement.classList.remove('hidden');

        // Verifica o estado atual do áudio para exibir o texto correto no botão
        const audio = document.getElementById('game-audio');
        const audioButtonText = (audio && !audio.paused) ? '⏸️ Pausar Música' : '▶️ Tocar Música';

        content.innerHTML = `
            <div class="w-full h-full flex flex-col justify-end p-4 md:p-8 relative">

<div class="absolute top-4 right-4 z-30">
                    <button id="play-pause-btn" onclick="toggleAudio()" class="btn-primary py-2 px-5 text-lg opacity-80 hover:opacity-100">
                        ${audioButtonText}
                    </button>
                </div>


<div class="game-dialog-box w-full max-w-full z-20">
                    <h3 class="text-xl font-bold text-glinda-pink mb-2">Glinda:</h3>
                    <p class="text-lg leading-relaxed italic mb-4">
                        "${currentText}"
                    </p>

                    <div class="text-right">
                        <button onclick="${isLast ? 'startQuiz()' : 'nextStory()'} " class="btn-theme bg-glinda-pink text-white hover:bg-pink-500 py-2 px-4 text-sm">
                            ${isLast ? 'Iniciar o Quiz de Oz! >>' : 'Continuar >>'}

                        </button>
                        <p class="text-xs text-gray-400 mt-2">Clique ou pressione ENTER para continuar</p>
                    </div>
                </div>
            </div>
        `;
    }

    /** Avança para o próximo slide da história */
    function nextStory() {
        if (GAME_STATE.currentStoryIndex < GAME_STATE.storyText.length - 1) {
            GAME_STATE.currentStoryIndex++;
            renderStoryPhase();
        }
    }

    /** Inicia a fase do Quiz após a história */
    function startQuiz() {
        // Remove o listener do Enter ao sair da fase da história
        removeStoryKeyListener();

        const audio = document.getElementById('game-audio');
        if (audio && !audio.paused) {
            audio.pause();
        }

        // --- TRANSIÇÃO 2: STORY -> QUIZ ---
        const content = document.getElementById('game-content');

        // 1. Aplica a animação de fade-out no conteúdo VN
        content.classList.add('animate-fade-out');

        // 2. Espera a animação terminar (500ms) antes de renderizar a fase do Quiz
        setTimeout(() => {
            GAME_STATE.phase = 'quiz';
            GAME_STATE.teamOrderIndex = 0;
            GAME_STATE.currentQuestionIndex = 0; // Reset index for questions
            GAME_STATE.questionsUsedIds.clear(); // Clear used questions for a new game

            // 3. Remove classes do VN (fixo, fade-out) e restaura o fluxo normal
            content.classList.remove('fixed', 'inset-0', 'p-0', 'm-0', 'story-enter', 'animate-fade-out');
             content.classList.add('relative', 'flex-col', 'justify-start', 'items-center', 'py-8'); // Reapply standard layout classes
            document.body.style.overflow = 'auto';
            content.style.minHeight = 'auto'; // Reset min-height

             // 4. Garante que o fundo esmeralda esteja visível para o quiz
             emeraldBackgroundElement.classList.remove('hidden');


            // 5. Adiciona um fade-in para introduzir o conteúdo do quiz
            content.classList.add('animate-fade-in');

            // 6. Renderiza a próxima fase
            renderQuizPhase();

            // 7. Remove o fade-in após o uso
            setTimeout(() => { content.classList.remove('animate-fade-in'); }, 500);

        }, 500);
    }

    /** Renderiza o Placar lateral (ou superior em mobile) */
    function renderScoreboard() {
        const sortedTeams = Object.entries(GAME_STATE.scores).sort(([, scoreA], [, scoreB]) => scoreB - scoreA);

        return `
            <div class="w-full md:w-64 md:sticky md:top-8 quiz-scoreboard mt-8 md:mt-0"> <!-- Add sticky positioning and top margin -->
                <h3 class="text-xl font-bold text-center mb-3 border-b pb-2">Placar Atual</h3>
                <ul class="space-y-2">
                    ${sortedTeams.map(([team, score]) => `
                        <li class="flex justify-between items-center text-lg">
                            <span class="font-medium ${score === sortedTeams[0][1] && score > 0 ? 'font-extrabold' : ''}">${team}</span>
                            <span class="text-2xl font-mono text-wicked-green">${score}</span>
                        </li>
                    `).join('')}
                </ul>
            </div>
        `;
    }

    /** Continua para a próxima rodada após o clique no botão 'Próxima Rodada' */
     function continueQuizRound() {
        const quizCard = document.getElementById('quiz-card');
        if (quizCard) {
            quizCard.classList.remove('is-flipped');
        }

        // Espera a animação do card desvirar (1s) mais um pequeno buffer
        if (GAME_STATE.questionsUsedIds.size < GAME_STATE.quizQuestions.length) {
            setTimeout(() => {
                const content = document.getElementById('game-content');
                content.classList.add('animate-fade-in');
                renderQuizPhase();
                setTimeout(() => { content.classList.remove('animate-fade-in'); }, 500);
            }, 500); // Espera o card desvirar
        } else {
            // Acabaram as perguntas, vai para os resultados
            setTimeout(() => {
                renderResultsPhase();
            }, 500);
        }
    }

    /** Pega a próxima pergunta aleatória que ainda não foi usada */
    function getNextRandomQuestion() {
        const availableQuestions = GAME_STATE.quizQuestions.filter(
            q => !GAME_STATE.questionsUsedIds.has(q.id)
        );

        if (availableQuestions.length === 0) {
            return null; // Acabaram as perguntas
        }

        const randomIndex = Math.floor(Math.random() * availableQuestions.length);
        const question = availableQuestions[randomIndex];

        return question;
    }

    /** Renderiza a tela principal do Quiz (pergunta e placar) */
    function renderQuizPhase() {
        GAME_STATE.phase = 'quiz';
        updateScreenLayout();

        if (GAME_STATE.questionsUsedIds.size >= GAME_STATE.quizQuestions.length) {
            return renderResultsPhase();
        }

        const teamName = GAME_STATE.teamOrder[GAME_STATE.teamOrderIndex];
        const questionData = getNextRandomQuestion();

        if (!questionData) return renderResultsPhase();

        CURRENT_QUESTION_DATA = questionData;
        const question = questionData.q;
        const options = [...questionData.options];
        const content = document.getElementById('game-content');
        const currentRound = GAME_STATE.questionsUsedIds.size + 1;

        shuffleArray(options);

        // Layout do Quiz: Placar à direita (desktop) ou em cima (mobile)
        content.innerHTML = `
            <div class="max-w-7xl mx-auto p-4 w-full h-full flex flex-col-reverse md:flex-row gap-8 justify-center items-start overflow-y-auto">

                <!-- Coluna Principal (Quiz) -->
                <div class="flex-grow w-full max-w-3xl perspective-1000">
                    <div id="quiz-card" class="flip-card">

                        <!-- Frente do Card (Pergunta) -->
                        <div id="card-front" class="flip-card-face flip-card-front">

                            <div class="quiz-card-vn w-full mx-auto p-6 md:p-8 relative">

                                <!-- Cabeçalho do Time/Rodada -->
                                <div class="text-center p-3 bg-oz-yellow/90 rounded-xl mb-6 border-4 border-wicked-green shadow-xl">
                                    <p class="text-lg font-semibold text-gray-900">
                                        Rodada <span class="font-extrabold text-2xl">${currentRound}</span> / ${GAME_STATE.quizQuestions.length} | Time:
                                        <span class="font-extrabold text-gray-900 text-2xl">${teamName}</span>
                                    </p>
                                </div>

                                <!-- Texto da Pergunta -->
                                <p class="question-text font-semibold mb-6">
                                    <span class="font-black text-wicked-green mr-2 text-4xl">Q:</span> ${question}
                                </p>

                                <!-- Opções -->
                                <div id="options-area" class="options-container">
                                    ${options.map((opt, index) => `
                                        <button
                                            class="option-button-vn"
                                            onclick="handleOptionClick(${opt.isCorrect}, this, '${opt.text}')">
                                            <span class="font-extrabold text-glinda-pink mr-2 text-2xl">${String.fromCharCode(65 + index)}:</span> ${opt.text}
                                        </button>
                                    `).join('')}
                                </div>

                                <p class="text-center text-sm text-gray-400 mt-6 italic">
                                    (Mediador: Clique na alternativa escolhida pelo time.)
                                </p>
                            </div>
                        </div>

                        <!-- Verso do Card (Feedback) -->
                        <div id="card-back" class="flip-card-face flip-card-back">
                            <!-- Conteúdo do feedback será injetado aqui -->
                        </div>
                    </div>
                </div>

                <!-- Barra Lateral (Placar) -->
                ${renderScoreboard()}

            </div>
        `;
    }

    /** Processa o clique em uma opção do quiz */
    function handleOptionClick(isCorrect, clickedButton, selectedOptionText) {
        const optionsArea = document.getElementById('options-area');
        const allButtons = optionsArea.querySelectorAll('button');

        const teamName = GAME_STATE.teamOrder[GAME_STATE.teamOrderIndex];

        // Desativa todos os botões
        allButtons.forEach(btn => btn.onclick = null);

        // Encontra o texto da resposta correta
        const correctAnswer = CURRENT_QUESTION_DATA.options.find(opt => opt.isCorrect);
        const correctAnswerText = correctAnswer.text;

        // Atualiza a pontuação
        if (isCorrect) {
            GAME_STATE.scores[teamName]++;
        }

        // Marca a pergunta como usada
        GAME_STATE.questionsUsedIds.add(CURRENT_QUESTION_DATA.id);

        // Avança para o próximo time
        GAME_STATE.teamOrderIndex = (GAME_STATE.teamOrderIndex + 1) % GAME_STATE.teams.length;

        // Destaca visualmente as respostas
        allButtons.forEach(btn => {
            const buttonText = btn.innerText.substring(btn.innerText.indexOf(':') + 2);

            btn.classList.remove('bg-gray-800/70', 'border-oz-yellow', 'hover:bg-oz-yellow/30'); // Remove estilos base

            if (btn === clickedButton) {
                if (isCorrect) {
                    btn.classList.add('correct');
                } else {
                    btn.classList.add('incorrect');
                }
            } else if (buttonText === correctAnswerText) {
                // Destaca a correta se não foi a clicada
                btn.classList.add('option-button-vn', 'correct-unselected');
            } else {
                // Apaga as outras incorretas
                btn.classList.add('option-button-vn', 'bg-gray-600/50', 'border-gray-700', 'opacity-50');
            }
        });

        // Atualiza o placar
        const scoreboardContainer = document.querySelector('.quiz-scoreboard');
        if (scoreboardContainer) {
            scoreboardContainer.outerHTML = renderScoreboard();
        }


        // Define o conteúdo do verso do cartão
        const backContent = `
            <div class="h-full w-full flex flex-col justify-center items-center p-8 text-center bg-white/95 rounded-2xl">
                <h3 class="text-4xl font-extrabold mb-6 text-glinda-pink">Resultado Mágico</h3>

                ${isCorrect ?
                    `<p class="text-5xl mb-4 text-hot-pink">✨ CORRETO! ✨</p>
                     <p class="text-2xl text-gray-800">Ponto para o time ${teamName}! Parabéns, essa foi uma resposta fabulosa!</p>` :
                    `<p class="text-5xl mb-4 text-red-600">❌ INCORRETO ❌</p>
                     <p class="text-2xl text-gray-800">O time ${teamName} errou! A Bruxa Má não ficaria feliz.</p>`
                }

                <div class="mt-8 p-6 rounded-xl w-full max-w-sm border-4 ${isCorrect ? 'border-hot-pink bg-hot-pink/10' : 'border-red-600 bg-red-100'}">
                    <p class="text-xl font-bold text-gray-700 mb-2">A Resposta Certa Era:</p>
                    <p class="text-2xl font-extrabold text-hot-pink">${correctAnswerText}</p>
                </div>

                <button onclick="continueQuizRound()" class="btn-primary mt-10 text-xl py-4 px-8">
                    ${GAME_STATE.questionsUsedIds.size < GAME_STATE.quizQuestions.length ? 'Próxima Rodada!' : 'Ver Resultados Finais!'}
                </button>
            </div>
        `;

        document.getElementById('card-back').innerHTML = backContent;
        setTimeout(() => {
            document.getElementById('quiz-card').classList.add('is-flipped');
        }, 300); // Pequeno delay para o usuário ver a cor da resposta
    }

    /** Renderiza a tela final de resultados */
    function renderResultsPhase() {
        GAME_STATE.phase = 'results';
        updateScreenLayout();

        const content = document.getElementById('game-content');

        content.classList.remove('animate-fade-in', 'animate-fade-out', 'fixed', 'inset-0', 'p-0', 'm-0', 'flex-col', 'justify-center', 'items-center');
        content.classList.add('relative', 'flex-col', 'justify-center', 'items-center', 'animate-fade-in'); // Volta para o layout padrão para resultados

        document.body.style.overflow = 'auto';
        content.style.minHeight = 'auto';

        emeraldBackgroundElement.classList.add('hidden'); // Esconde o fundo esmeralda

        const sortedTeams = Object.entries(GAME_STATE.scores).sort(([, scoreA], [, scoreB]) => scoreB - scoreA);
        const winner = sortedTeams[0];

        content.innerHTML = `
            <div class="w-full max-w-4xl mx-auto bg-glinda-pink/10 p-8 md:p-16 rounded-3xl shadow-2xl border-4 border-wicked-green text-center animate-fade-in">

                <h2 class="text-5xl lg:text-6xl font-extrabold mb-6 text-wicked-green">
                    <span class="text-6xl lg:text-7xl text-oz-yellow">🏆</span>
                    Resultados Finais!
                    <span class="text-6xl lg:text-7xl text-oz-yellow">🏆</span>
                </h2>

                <div class="bg-white p-8 rounded-2xl shadow-inner border-4 border-glinda-pink">
                    <p class="text-3xl font-bold text-gray-800">O Time Vencedor é...</p>
                    <p class="text-7xl font-black text-hot-pink my-4">${winner[0]}</p>
                    <p class="text-4xl font-bold text-gray-800">Com <span class="text-5xl text-wicked-green">${winner[1]}</span> pontos!</p>
                </div>

                <h3 class="text-3xl font-bold text-wicked-green mt-12 mb-6">Placar Completo</h3>

                <ul class="space-y-3 max-w-lg mx-auto">
                    ${sortedTeams.map(([team, score], index) => `
                        <li class="flex justify-between items-center text-2xl p-4 rounded-lg ${index === 0 ? 'bg-oz-yellow/30 border-2 border-oz-yellow' : 'bg-white/50'}">
                            <span class="font-bold ${index === 0 ? 'text-hot-pink' : 'text-gray-700'}">${index + 1}. ${team}</span>
                            <span class="text-3xl font-mono text-wicked-green">${score}</span>
                        </li>
                    `).join('')}
                </ul>

                <button onclick="renderSetupPhase()" class="btn-primary mt-12 text-2xl py-4 px-10">
                    Jogar Novamente!
                </button>
            </div>
        `;

        // Remove a classe de fade-in após a animação
        setTimeout(() => { content.classList.remove('animate-fade-in'); }, 500);
    }

    // --- PONTO DE ENTRADA ---
    /** Inicia o jogo quando a página carrega */
    window.onload = renderSetupPhase;

</script>
</body>
</html>